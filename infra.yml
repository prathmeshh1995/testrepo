resources:
  repositories:
    - repository: IaC-Automation
      type: git
      endpoint: IaC-Repo-Connection
      name: YASH-IaC-Centralized-AWS/IaC-Automation
      ref: refs/heads/main

variables:
- group: AWS-VG

- name: S3
  value: 'true'

trigger:
- none

pool:
  vmImage: ubuntu-latest

steps:
- checkout: IaC-Automation
- checkout: self

- task: CloudFormationCreateOrUpdateStack@1
  displayName: S3 Template
  condition: eq('${{ variables.S3}}', 'true')
  inputs:
    awsCredentials: '$(ServiceConnection)'
    regionName: 'us-east-1'
    stackName: '$(StackName)'
    templateSource: 'file'
    templateFile: 'IaC-Automation/Modules/Storage/S3/Template.yml'
    templateParametersFile: '$(RepoName)/Modules/Storage/S3/Parameter.json'
    templateParameters: |
      - ParameterKey: BucketName
        ParameterValue: "$(BucketName)"
      - ParameterKey: Environment
        ParameterValue: "$(Environment)"
      - ParameterKey: ResourceOwnerName
        ParameterValue: "$(ResourceOwnerName)"
      - ParameterKey: Region
        ParameterValue: "$(Region)"
    capabilityAutoExpand: true